#!/usr/local/bin/python3
import os
import sys
import comtrade

mode = 'normal'
if len(sys.argv) == 2:
    waveFile = os.path.abspath(sys.argv[1])
    if not os.path.exists(waveFile):
        print('\nThe file doesn\'t exist, please select a valid contrade configuration file!\n')
        sys.exit(1)
elif len(sys.argv) == 3:
    if sys.argv[1] == '-q':
        mode = 'quiet'
    waveFile = os.path.abspath(sys.argv[2])
    if not os.path.exists(waveFile):
        print('\nThe file doesn\'t exist, please select a valid contrade configuration file!\n')
        sys.exit(1)
else:
    print('\nExample: comtrade file')
    print('  file: the cfg or dat file you want to parse\n')
    sys.exit(1)

if '.dat' in waveFile:
    waveFile = waveFile.replace('.dat', '.cfg')

parser = comtrade.ComtradeParser(waveFile)
if parser.result != 'parsed':
    print('\nParse failed! Error: %s\n' % parser.result)
    sys.exit(1)

parser.plot()
parser.savefig()
if mode != 'quiet':
    parser.show()
